-- ====================
-- INITIAL SETUP
-- ====================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")
local Stats = game:GetService("Stats")
local VirtualInputManager = game:GetService("VirtualInputManager")

-- ====================
-- GUI SETUP
-- ====================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SerotoninGUI"
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 500, 0, 600)
MainFrame.Position = UDim2.new(0.3, 0, 0.3, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(13, 17, 23)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(22, 27, 34)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "Root - .gg/5yhJG635bE"
Title.TextColor3 = Color3.fromRGB(248, 249, 250)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.Parent = TitleBar

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(22, 27, 34)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(248, 249, 250)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 12
CloseButton.Parent = TitleBar

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Tabs
local TabContainer = Instance.new("Frame")
TabContainer.Size = UDim2.new(0, 100, 1, -30)
TabContainer.Position = UDim2.new(0, 0, 0, 30)
TabContainer.BackgroundColor3 = Color3.fromRGB(22, 27, 34)
TabContainer.BorderSizePixel = 0
TabContainer.Parent = MainFrame

-- NEUER METHOD TAB HINZUGEFÃœGT
local Tabs = {"Aimbot", "Visual", "Method", "Misc"}
local TabButtons = {}
local TabFrames = {}

local function createTabButton(name, index)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 40)
    button.Position = UDim2.new(0, 0, 0, (index-1) * 40)
    button.BackgroundColor3 = Color3.fromRGB(22, 27, 34)
    button.BorderSizePixel = 0
    button.Text = name
    button.TextColor3 = Color3.fromRGB(139, 148, 158)
    button.Font = Enum.Font.Gotham
    button.TextSize = 12
    button.Parent = TabContainer
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -100, 1, -30)
    frame.Position = UDim2.new(0, 100, 0, 30)
    frame.BackgroundColor3 = Color3.fromRGB(13, 17, 23)
    frame.BorderSizePixel = 0
    frame.Visible = index == 1
    frame.Parent = MainFrame
    
    local scrollingFrame = Instance.new("ScrollingFrame")
    scrollingFrame.Size = UDim2.new(1, 0, 1, 0)
    scrollingFrame.BackgroundTransparency = 1
    scrollingFrame.BorderSizePixel = 0
    scrollingFrame.ScrollBarThickness = 5
    scrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(48, 54, 61)
    scrollingFrame.CanvasSize = UDim2.new(0, 0, 3, 0)
    scrollingFrame.Parent = frame
    
    TabButtons[name] = button
    TabFrames[name] = scrollingFrame
    
    button.MouseButton1Click:Connect(function()
        for _, f in pairs(TabFrames) do
            f.Parent.Visible = false
        end
        frame.Visible = true
        for _, b in pairs(TabButtons) do
            b.BackgroundColor3 = Color3.fromRGB(22, 27, 34)
            b.TextColor3 = Color3.fromRGB(139, 148, 158)
        end
        button.BackgroundColor3 = Color3.fromRGB(33, 38, 45)
        button.TextColor3 = Color3.fromRGB(248, 249, 250)
    end)
end

for i, tab in ipairs(Tabs) do
    createTabButton(tab, i)
end

-- UI Functions
function createSection(parent, title, x, y, width, height)
    local section = Instance.new("Frame")
    section.Size = UDim2.new(0, width, 0, height)
    section.Position = UDim2.new(0, x, 0, y)
    section.BackgroundColor3 = Color3.fromRGB(22, 27, 34)
    section.BorderSizePixel = 0
    section.Parent = parent
    
    local sectionTitle = Instance.new("TextLabel")
    sectionTitle.Size = UDim2.new(1, 0, 0, 25)
    sectionTitle.BackgroundColor3 = Color3.fromRGB(33, 38, 45)
    sectionTitle.BorderSizePixel = 0
    sectionTitle.Text = "  " .. title
    sectionTitle.TextColor3 = Color3.fromRGB(248, 249, 250)
    sectionTitle.Font = Enum.Font.GothamBold
    sectionTitle.TextSize = 11
    sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
    sectionTitle.Parent = section
    
    local content = Instance.new("Frame")
    content.Size = UDim2.new(1, 0, 1, -25)
    content.Position = UDim2.new(0, 0, 0, 25)
    content.BackgroundTransparency = 1
    content.Parent = section
    
    return content
end

function createToggle(parent, text, defaultState, hotkey, callback)
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Size = UDim2.new(1, -20, 0, 25)
    toggleFrame.Position = UDim2.new(0, 10, 0, #parent:GetChildren() * 30)
    toggleFrame.BackgroundTransparency = 1
    toggleFrame.Parent = parent
    
    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0, 18, 0, 18)
    toggleButton.Position = UDim2.new(0, 0, 0, 3)
    toggleButton.BackgroundColor3 = defaultState and Color3.fromRGB(35, 134, 54) or Color3.fromRGB(48, 54, 61)
    toggleButton.BorderSizePixel = 0
    toggleButton.Text = ""
    toggleButton.Parent = toggleFrame
    
    local toggleLabel = Instance.new("TextLabel")
    toggleLabel.Size = UDim2.new(0, 110, 1, 0)
    toggleLabel.Position = UDim2.new(0, 25, 0, 0)
    toggleLabel.BackgroundTransparency = 1
    toggleLabel.Text = text
    toggleLabel.TextColor3 = Color3.fromRGB(248, 249, 250)
    toggleLabel.Font = Enum.Font.Gotham
    toggleLabel.TextSize = 10
    toggleLabel.TextXAlignment = Enum.TextXAlignment.Left
    toggleLabel.Parent = toggleFrame
    
    local hotkeyButton = Instance.new("TextButton")
    hotkeyButton.Size = UDim2.new(0, 50, 0, 18)
    hotkeyButton.Position = UDim2.new(1, -50, 0, 3)
    hotkeyButton.BackgroundColor3 = Color3.fromRGB(48, 54, 61)
    hotkeyButton.BorderSizePixel = 0
    hotkeyButton.Text = hotkey
    hotkeyButton.TextColor3 = Color3.fromRGB(139, 148, 158)
    hotkeyButton.Font = Enum.Font.Gotham
    hotkeyButton.TextSize = 9
    hotkeyButton.Parent = toggleFrame
    
    local settingHotkey = false
    
    hotkeyButton.MouseButton1Click:Connect(function()
        settingHotkey = true
        hotkeyButton.Text = "..."
        hotkeyButton.BackgroundColor3 = Color3.fromRGB(35, 134, 54)
    end)
    
    local function handleHotkey(input)
        if settingHotkey then
            if input.UserInputType == Enum.UserInputType.Keyboard then
                local key = input.KeyCode.Name
                hotkeyButton.Text = key
                hotkeyButton.BackgroundColor3 = Color3.fromRGB(48, 54, 61)
                settingHotkey = false
                return key
            elseif input.UserInputType.Name:find("MouseButton") then
                local mouseKey = input.UserInputType.Name
                hotkeyButton.Text = mouseKey
                hotkeyButton.BackgroundColor3 = Color3.fromRGB(48, 54, 61)
                settingHotkey = false
                return mouseKey
            end
        end
        return nil
    end
    
    UserInputService.InputBegan:Connect(function(input)
        local newHotkey = handleHotkey(input)
        if newHotkey then
            hotkey = newHotkey
        else
            if (input.KeyCode.Name == hotkey) or (input.UserInputType.Name == hotkey) then
                local newState = not (toggleButton.BackgroundColor3 == Color3.fromRGB(35, 134, 54))
                toggleButton.BackgroundColor3 = newState and Color3.fromRGB(35, 134, 54) or Color3.fromRGB(48, 54, 61)
                callback(newState)
            end
        end
    end)
    
    toggleButton.MouseButton1Click:Connect(function()
        local newState = not (toggleButton.BackgroundColor3 == Color3.fromRGB(35, 134, 54))
        toggleButton.BackgroundColor3 = newState and Color3.fromRGB(35, 134, 54) or Color3.fromRGB(48, 54, 61)
        callback(newState)
    end)
    
    return toggleFrame
end

function createSlider(parent, text, min, max, default, callback)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1, -20, 0, 40)
    sliderFrame.Position = UDim2.new(0, 10, 0, #parent:GetChildren() * 30)
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.Parent = parent
    
    local sliderLabel = Instance.new("TextLabel")
    sliderLabel.Size = UDim2.new(1, 0, 0, 15)
    sliderLabel.BackgroundTransparency = 1
    sliderLabel.Text = text
    sliderLabel.TextColor3 = Color3.fromRGB(248, 249, 250)
    sliderLabel.Font = Enum.Font.Gotham
    sliderLabel.TextSize = 10
    sliderLabel.TextXAlignment = Enum.TextXAlignment.Left
    sliderLabel.Parent = sliderFrame
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Size = UDim2.new(0, 40, 0, 15)
    valueLabel.Position = UDim2.new(1, -40, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(default)
    valueLabel.TextColor3 = Color3.fromRGB(139, 148, 158)
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.TextSize = 9
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Parent = sliderFrame
    
    local sliderBG = Instance.new("Frame")
    sliderBG.Size = UDim2.new(1, 0, 0, 4)
    sliderBG.Position = UDim2.new(0, 0, 0, 20)
    sliderBG.BackgroundColor3 = Color3.fromRGB(48, 54, 61)
    sliderBG.BorderSizePixel = 0
    sliderBG.Parent = sliderFrame
    
    local sliderFill = Instance.new("Frame")
    sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    sliderFill.BackgroundColor3 = Color3.fromRGB(35, 134, 54)
    sliderFill.BorderSizePixel = 0
    sliderFill.Parent = sliderBG
    
    local sliderHandle = Instance.new("TextButton")
    sliderHandle.Size = UDim2.new(0, 8, 0, 12)
    sliderHandle.Position = UDim2.new((default - min) / (max - min), -4, 0, -4)
    sliderHandle.BackgroundColor3 = Color3.fromRGB(248, 249, 250)
    sliderHandle.BorderSizePixel = 0
    sliderHandle.Text = ""
    sliderHandle.Parent = sliderFrame
    
    local dragging = false
    
    sliderHandle.MouseButton1Down:Connect(function()
        dragging = true
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    local function updateSlider(value)
        value = math.clamp(value, min, max)
        valueLabel.Text = tostring(value)
        local percentage = (value - min) / (max - min)
        sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
        sliderHandle.Position = UDim2.new(percentage, -4, 0, -4)
        callback(value)
    end
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = UserInputService:GetMouseLocation()
            local sliderAbsolutePos = sliderBG.AbsolutePosition
            local sliderAbsoluteSize = sliderBG.AbsoluteSize.X
            
            local relativeX = math.clamp(mousePos.X - sliderAbsolutePos.X, 0, sliderAbsoluteSize)
            local percentage = relativeX / sliderAbsoluteSize
            local value = math.floor(min + (max - min) * percentage)
            
            updateSlider(value)
        end
    end)
    
    return sliderFrame
end

function createDropdown(parent, text, options, default, callback)
    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(1, -20, 0, 25)
    dropdownFrame.Position = UDim2.new(0, 10, 0, #parent:GetChildren() * 30)
    dropdownFrame.BackgroundTransparency = 1
    dropdownFrame.Parent = parent
    
    local dropdownLabel = Instance.new("TextLabel")
    dropdownLabel.Size = UDim2.new(0, 90, 1, 0)
    dropdownLabel.BackgroundTransparency = 1
    dropdownLabel.Text = text
    dropdownLabel.TextColor3 = Color3.fromRGB(248, 249, 250)
    dropdownLabel.Font = Enum.Font.Gotham
    dropdownLabel.TextSize = 10
    dropdownLabel.TextXAlignment = Enum.TextXAlignment.Left
    dropdownLabel.Parent = dropdownFrame
    
    local dropdownButton = Instance.new("TextButton")
    dropdownButton.Size = UDim2.new(0, 90, 0, 20)
    dropdownButton.Position = UDim2.new(1, -90, 0, 2)
    dropdownButton.BackgroundColor3 = Color3.fromRGB(33, 38, 45)
    dropdownButton.BorderSizePixel = 0
    dropdownButton.Text = default
    dropdownButton.TextColor3 = Color3.fromRGB(248, 249, 250)
    dropdownButton.Font = Enum.Font.Gotham
    dropdownButton.TextSize = 9
    dropdownButton.Parent = dropdownFrame
    
    local dropdownOpen = false
    local currentSelection = default
    
    dropdownButton.MouseButton1Click:Connect(function()
        if dropdownOpen then 
            for _, obj in pairs(parent:GetChildren()) do
                if obj:IsA("Frame") and obj.Name == "DropdownOptions" then
                    obj:Destroy()
                end
            end
            dropdownOpen = false
            return 
        end
        
        dropdownOpen = true
        
        for _, obj in pairs(parent:GetChildren()) do
            if obj:IsA("Frame") and obj.Name == "DropdownOptions" then
                obj:Destroy()
            end
        end
        
        local dropdownOptions = Instance.new("Frame")
        dropdownOptions.Name = "DropdownOptions"
        dropdownOptions.Size = UDim2.new(0, 90, 0, #options * 20)
        dropdownOptions.Position = UDim2.new(1, -90, 1, 0)
        dropdownOptions.BackgroundColor3 = Color3.fromRGB(33, 38, 45)
        dropdownOptions.BorderSizePixel = 0
        dropdownOptions.ZIndex = 100
        dropdownOptions.Parent = dropdownFrame
        
        for i, option in ipairs(options) do
            local optionButton = Instance.new("TextButton")
            optionButton.Size = UDim2.new(1, 0, 0, 20)
            optionButton.Position = UDim2.new(0, 0, 0, (i-1) * 20)
            optionButton.BackgroundColor3 = Color3.fromRGB(33, 38, 45)
            optionButton.BorderSizePixel = 0
            optionButton.Text = option
            optionButton.TextColor3 = Color3.fromRGB(248, 249, 250)
            optionButton.Font = Enum.Font.Gotham
            optionButton.TextSize = 9
            optionButton.ZIndex = 101
            optionButton.Parent = dropdownOptions
            
            optionButton.MouseButton1Click:Connect(function()
                currentSelection = option
                dropdownButton.Text = option
                callback(option)
                dropdownOptions:Destroy()
                dropdownOpen = false
            end)
        end
        
        local connection
        connection = UserInputService.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                local mousePos = input.Position
                local absolutePos = dropdownOptions.AbsolutePosition
                local absoluteSize = dropdownOptions.AbsoluteSize
                
                if not (mousePos.X >= absolutePos.X and mousePos.X <= absolutePos.X + absoluteSize.X and
                       mousePos.Y >= absolutePos.Y and mousePos.Y <= absolutePos.Y + absoluteSize.Y) then
                    dropdownOptions:Destroy()
                    dropdownOpen = false
                    connection:Disconnect()
                end
            end
        end)
    end)
    
    return dropdownFrame
end

-- NEUE FUNKTION: TextBox fÃ¼r Orbit Target Name
function createTextBox(parent, text, placeholder, default, callback)
    local textBoxFrame = Instance.new("Frame")
    textBoxFrame.Size = UDim2.new(1, -20, 0, 25)
    textBoxFrame.Position = UDim2.new(0, 10, 0, #parent:GetChildren() * 30)
    textBoxFrame.BackgroundTransparency = 1
    textBoxFrame.Parent = parent
    
    local textBoxLabel = Instance.new("TextLabel")
    textBoxLabel.Size = UDim2.new(0, 90, 1, 0)
    textBoxLabel.BackgroundTransparency = 1
    textBoxLabel.Text = text
    textBoxLabel.TextColor3 = Color3.fromRGB(248, 249, 250)
    textBoxLabel.Font = Enum.Font.Gotham
    textBoxLabel.TextSize = 10
    textBoxLabel.TextXAlignment = Enum.TextXAlignment.Left
    textBoxLabel.Parent = textBoxFrame
    
    local textBox = Instance.new("TextBox")
    textBox.Size = UDim2.new(0, 120, 0, 20)
    textBox.Position = UDim2.new(1, -120, 0, 2)
    textBox.BackgroundColor3 = Color3.fromRGB(33, 38, 45)
    textBox.BorderSizePixel = 0
    textBox.Text = default
    textBox.PlaceholderText = placeholder
    textBox.TextColor3 = Color3.fromRGB(248, 249, 250)
    textBox.Font = Enum.Font.Gotham
    textBox.TextSize = 9
    textBox.ClearTextOnFocus = false
    textBox.Parent = textBoxFrame
    
    textBox.FocusLost:Connect(function()
        callback(textBox.Text)
    end)
    
    return textBoxFrame
end

-- ====================
-- GLOBALE VARIABLEN
-- ====================
local AimbotEnabled = false
local AimbotHotkey = "MouseButton3"
local TriggerbotEnabled = false
local TriggerbotHotkey = "MouseButton4"
local AimbotFOV = 160
local AimbotSmoothness = 15
local AimbotMethod = "Camera"
local TargetMode = "Head"
local FOVCircleEnabled = false
local FillCircleEnabled = false
local ShowTargetEnabled = false
local TargetPriority = "Crosshair"
local WallCheckEnabled = true
local TriggerbotDelay = 50
local TriggerbotHitchance = 100
local TeamCheckEnabled = false

-- ESP VARIABLEN
local BoxESPEnabled = false
local TracerESPEnabled = false
local NameESPEnabled = false
local HealthBarESPEnabled = false
local DistanceESPEnabled = false
local ChamsEnabled = false
local SkeletonESPEnabled = false
local ESPTeamCheckEnabled = false
local PingESPEnabled = false

-- VISUAL EFFECTS VARIABLEN
local NoFogEnabled = false
local FullBrightEnabled = false
local NoShadowsEnabled = false

-- RAGE VARIABLEN
local RageSpinEnabled = false
local SpinSpeed = 100
-- NEUE ORBIT VARIABLEN
local RageOrbitEnabled = false
local OrbitSpeed = 50
local OrbitDistance = 15
local OrbitHeight = 10
local OrbitTargetName = ""

-- MISC VARIABLEN
local FPSBoostEnabled = false
local PotatoModeEnabled = false
local GraySkyboxEnabled = false
local OriginalSettings = {}

-- Speicher fÃ¼r Spieler-Pings
local PlayerPings = {}
local LastPingUpdate = {}

local ESPDrawings = {}
local FOVCircle = Drawing.new("Circle")
local FillCircle = Drawing.new("Circle")
local TargetIndicator = Drawing.new("Square")
local LastTriggerTime = 0
local VirtualInputManager = game:GetService("VirtualInputManager")
local ChamFolder = Instance.new("Folder")
ChamFolder.Name = "Cham_Folder"
ChamFolder.Parent = game.CoreGui

-- ====================
-- AIMBOT TAB
-- ====================
local AimbotFrame = TabFrames["Aimbot"]
AimbotFrame.CanvasSize = UDim2.new(0, 0, 0, 700)

-- Main Aimbot Section
local MainAimbotSection = createSection(AimbotFrame, "Main Aimbot", 10, 10, 360, 310)

local aimbotToggle = createToggle(MainAimbotSection, "Aimbot", false, AimbotHotkey, function(state)
    AimbotEnabled = state
    print("Aimbot:", state and "AN" or "AUS")
end)

local aimMethodDropdown = createDropdown(MainAimbotSection, "Aim Method", {"Mouse", "Camera"}, "Camera", function(selected)
    AimbotMethod = selected
    print("Aim Method:", selected)
end)

local targetModeDropdown = createDropdown(MainAimbotSection, "Target Mode", {"Head", "Torso", "Left Arm", "Right Arm", "Left Leg", "Right Leg"}, "Head", function(selected)
    TargetMode = selected
    print("Target Mode:", selected)
end)

local targetPriorityDropdown = createDropdown(MainAimbotSection, "Target Priority", {"Crosshair", "Nearest", "Distance"}, "Crosshair", function(selected)
    TargetPriority = selected
    print("Target Priority:", selected)
end)

createToggle(MainAimbotSection, "Team Check", false, "", function(state)
    TeamCheckEnabled = state
    print("Team Check:", state and "AN" or "AUS")
end)

local smoothnessSlider = createSlider(MainAimbotSection, "Smoothness", 1, 30, 15, function(value)
    AimbotSmoothness = value
    print("Smoothness:", value)
end)

local fovSlider = createSlider(MainAimbotSection, "Aimbot FOV", 0, 500, 160, function(value)
    AimbotFOV = value
    print("Aimbot FOV:", value)
end)

-- Extra Features Section
local ExtraAimbotSection = createSection(AimbotFrame, "Extra Features", 10, 330, 360, 150)

createToggle(ExtraAimbotSection, "FOV Circle", false, "", function(state)
    FOVCircleEnabled = state
    print("FOV Circle:", state and "AN" or "AUS")
end)

createToggle(ExtraAimbotSection, "Fill Circle", false, "", function(state)
    FillCircleEnabled = state
    print("Fill Circle:", state and "AN" or "AUS")
end)

createToggle(ExtraAimbotSection, "Show Target", false, "", function(state)
    ShowTargetEnabled = state
    print("Show Target:", state and "AN" or "AUS")
end)

createToggle(ExtraAimbotSection, "Wall Check", true, "", function(state)
    WallCheckEnabled = state
    print("Wall Check:", state and "AN" or "AUS")
end)

-- Triggerbot Section
local TriggerbotSection = createSection(AimbotFrame, "Triggerbot", 10, 490, 360, 150)

createToggle(TriggerbotSection, "Triggerbot", false, TriggerbotHotkey, function(state)
    TriggerbotEnabled = state
    print("Triggerbot:", state and "AN" or "AUS")
end)

createSlider(TriggerbotSection, "Trigger Delay", 0, 500, 50, function(value)
    TriggerbotDelay = value
    print("Trigger Delay:", value)
end)

createSlider(TriggerbotSection, "Hitchance", 0, 100, 100, function(value)
    TriggerbotHitchance = value
    print("Hitchance:", value)
end)

-- ====================
-- VISUAL TAB
-- ====================
local VisualFrame = TabFrames["Visual"]
VisualFrame.CanvasSize = UDim2.new(0, 0, 0, 550)

-- Player ESP Section
local PlayerESPSection = createSection(VisualFrame, "Player ESP", 10, 10, 360, 300)

createToggle(PlayerESPSection, "Box ESP", false, "F1", function(state)
    BoxESPEnabled = state
    print("Box ESP:", state and "AN" or "AUS")
end)

createToggle(PlayerESPSection, "Tracer ESP", false, "F2", function(state)
    TracerESPEnabled = state
    print("Tracer ESP:", state and "AN" or "AUS")
end)

createToggle(PlayerESPSection, "Name ESP", false, "F3", function(state)
    NameESPEnabled = state
    print("Name ESP:", state and "AN" or "AUS")
end)

createToggle(PlayerESPSection, "Health Bar ESP", false, "F4", function(state)
    HealthBarESPEnabled = state
    print("Health Bar ESP:", state and "AN" or "AUS")
end)

createToggle(PlayerESPSection, "Distance ESP", false, "F5", function(state)
    DistanceESPEnabled = state
    print("Distance ESP:", state and "AN" or "AUS")
end)

createToggle(PlayerESPSection, "Ping ESP", false, "F8", function(state)
    PingESPEnabled = state
    print("Ping ESP:", state and "AN" or "AUS")
end)

createToggle(PlayerESPSection, "Skeleton ESP", false, "F7", function(state)
    SkeletonESPEnabled = state
    print("Skeleton ESP:", state and "AN" or "AUS")
end)

createToggle(PlayerESPSection, "Chams", false, "F6", function(state)
    ChamsEnabled = state
    print("Chams:", state and "AN" or "AUS")
    if not state then
        for _, obj in pairs(ChamFolder:GetChildren()) do
            obj:Destroy()
        end
    end
end)

-- Visual Effects Section
local EffectsSection = createSection(VisualFrame, "Visual Effects", 10, 320, 360, 120)

createToggle(EffectsSection, "No Fog", false, "", function(state)
    NoFogEnabled = state
    if state then
        if not OriginalSettings.FogEnd then
            OriginalSettings.FogEnd = Lighting.FogEnd
            OriginalSettings.FogStart = Lighting.FogStart
        end
        Lighting.FogEnd = 100000
        Lighting.FogStart = 100000
    else
        if OriginalSettings.FogEnd then
            Lighting.FogEnd = OriginalSettings.FogEnd
            Lighting.FogStart = OriginalSettings.FogStart or 0
        end
    end
    print("No Fog:", state and "AN" or "AUS")
end)

createToggle(EffectsSection, "Full Bright", false, "", function(state)
    FullBrightEnabled = state
    if state then
        if not OriginalSettings.Ambient then
            OriginalSettings.Ambient = Lighting.Ambient
            OriginalSettings.Brightness = Lighting.Brightness
            OriginalSettings.OutdoorAmbient = Lighting.OutdoorAmbient
            OriginalSettings.ClockTime = Lighting.ClockTime
        end
        Lighting.Ambient = Color3.new(1, 1, 1)
        Lighting.Brightness = 2
        Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
        Lighting.ClockTime = 14
    else
        if OriginalSettings.Ambient then
            Lighting.Ambient = OriginalSettings.Ambient
            Lighting.Brightness = OriginalSettings.Brightness
            Lighting.OutdoorAmbient = OriginalSettings.OutdoorAmbient
            Lighting.ClockTime = OriginalSettings.ClockTime or 14
        end
    end
    print("Full Bright:", state and "AN" or "AUS")
end)

createToggle(EffectsSection, "No Shadows", false, "", function(state)
    NoShadowsEnabled = state
    if state then
        if not OriginalSettings.GlobalShadows then
            OriginalSettings.GlobalShadows = Lighting.GlobalShadows
            OriginalSettings.ShadowSoftness = Lighting.ShadowSoftness
        end
        Lighting.GlobalShadows = false
        Lighting.ShadowSoftness = 0
    else
        if OriginalSettings.GlobalShadows then
            Lighting.GlobalShadows = OriginalSettings.GlobalShadows
            Lighting.ShadowSoftness = OriginalSettings.ShadowSoftness
        end
    end
    print("No Shadows:", state and "AN" or "AUS")
end)

-- ESP Team Check Section
local ESPTeamCheckSection = createSection(VisualFrame, "ESP Team Check", 10, 450, 360, 80)

createToggle(ESPTeamCheckSection, "ESP Team Check", false, "", function(state)
    ESPTeamCheckEnabled = state
    print("ESP Team Check:", state and "AN" or "AUS")
end)

-- ====================
-- METHOD TAB - MIT ORBIT ERWEITERT
-- ====================
local MethodFrame = TabFrames["Method"]
MethodFrame.CanvasSize = UDim2.new(0, 0, 0, 250)

-- Rage Section - MIT ORBIT ERWEITERT
local RageSection = createSection(MethodFrame, "Rage Features", 10, 10, 360, 230)

createToggle(RageSection, "Rage Spin", false, "", function(state)
    RageSpinEnabled = state
    if state then
        print("ðŸŒ€ RAGE SPIN AKTIVIERT!")
        print("âš ï¸ ACHTUNG: Sehr schnell, kann auffÃ¤llig sein!")
    else
        print("ðŸŒ€ RAGE SPIN DEAKTIVIERT")
    end
end)

createSlider(RageSection, "Spin Speed", 1, 100, 100, function(value)
    SpinSpeed = value
    print("Spin Speed auf", value, "gesetzt")
    if RageSpinEnabled then
        print("ðŸŒ€ Aktuelle Drehgeschwindigkeit:", value)
    end
end)

createToggle(RageSection, "Rage Orbit", false, "", function(state)
    RageOrbitEnabled = state
    if state then
        print("ðŸ”„ RAGE ORBIT AKTIVIERT!")
        print("ðŸŽ¯ Fliege um Zielspieler:", OrbitTargetName)
    else
        print("ðŸ”„ RAGE ORBIT DEAKTIVIERT")
    end
end)

local orbitTargetBox = createTextBox(RageSection, "Orbit Target", "Spieler Name", "", function(text)
    OrbitTargetName = text
    print("ðŸŽ¯ Orbit Target gesetzt auf:", text)
end)

createSlider(RageSection, "Orbit Speed", 1, 100, 50, function(value)
    OrbitSpeed = value
    print("ðŸ”„ Orbit Speed auf", value, "gesetzt")
end)

createSlider(RageSection, "Orbit Distance", 1, 50, 15, function(value)
    OrbitDistance = value
    print("ðŸ”„ Orbit Distance auf", value, "Studs gesetzt")
end)

createSlider(RageSection, "Orbit Height", 1, 20, 10, function(value)
    OrbitHeight = value
    print("ðŸ”„ Orbit Height auf", value, "Studs gesetzt")
end)

-- ====================
-- MISC TAB (ERWEITERT MIT GRAY SKYBOX)
-- ====================
local MiscFrame = TabFrames["Misc"]
MiscFrame.CanvasSize = UDim2.new(0, 0, 0, 180)

-- Performance Section
local PerformanceSection = createSection(MiscFrame, "Performance", 10, 10, 360, 160)

-- Gray Skybox Toggle hinzufÃ¼gen (NEU)
createToggle(PerformanceSection, "Gray Skybox", false, "", function(state)
    GraySkyboxEnabled = state
    
    if state then
        print("â˜ï¸ GRAY SKYBOX AKTIVIERT")
        
        -- Speichere originale Skybox
        if not OriginalSettings.Sky then
            OriginalSettings.Sky = {
                SkyboxBk = Lighting:FindFirstChild("SkyboxBk"),
                SkyboxDn = Lighting:FindFirstChild("SkyboxDn"),
                SkyboxFt = Lighting:FindFirstChild("SkyboxFt"),
                SkyboxLf = Lighting:FindFirstChild("SkyboxLf"),
                SkyboxRt = Lighting:FindFirstChild("SkyboxRt"),
                SkyboxUp = Lighting:FindFirstChild("SkyboxUp")
            }
        end
        
        -- LÃ¶sche existierende Skybox Decals
        for _, name in pairs({"SkyboxBk", "SkyboxDn", "SkyboxFt", "SkyboxLf", "SkyboxRt", "SkyboxUp"}) do
            local existing = Lighting:FindFirstChild(name)
            if existing then
                existing:Destroy()
            end
        end
        
        -- Setze die "Grey Sky Gradient 1" Skybox als Decals
        local skyboxId = "7196882525"  -- ID fÃ¼r "Grey Sky Gradient 1" als Decal
        
        -- Erstelle Decals fÃ¼r alle 6 Seiten
        local sides = {
            {Name = "SkyboxBk", Face = Enum.NormalId.Back},
            {Name = "SkyboxDn", Face = Enum.NormalId.Bottom},
            {Name = "SkyboxFt", Face = Enum.NormalId.Front},
            {Name = "SkyboxLf", Face = Enum.NormalId.Left},
            {Name = "SkyboxRt", Face = Enum.NormalId.Right},
            {Name = "SkyboxUp", Face = Enum.NormalId.Top}
        }
        
        for _, side in ipairs(sides) do
            local decal = Instance.new("Decal")
            decal.Name = side.Name
            decal.Texture = "rbxassetid://" .. skyboxId
            decal.Face = side.Face
            decal.Parent = Lighting
        end
        
        -- Auch die Sky-Properties setzen (falls benÃ¶tigt)
        if not OriginalSettings.SkyProperties then
            OriginalSettings.SkyProperties = {
                SkyboxBk = Lighting.Sky.SkyboxBk,
                SkyboxDn = Lighting.Sky.SkyboxDn,
                SkyboxFt = Lighting.Sky.SkyboxFt,
                SkyboxLf = Lighting.Sky.SkyboxLf,
                SkyboxRt = Lighting.Sky.SkyboxRt,
                SkyboxUp = Lighting.Sky.SkyboxUp
            }
        end
        
        Lighting.Sky.SkyboxBk = "rbxassetid://" .. skyboxId
        Lighting.Sky.SkyboxDn = "rbxassetid://" .. skyboxId
        Lighting.Sky.SkyboxFt = "rbxassetid://" .. skyboxId
        Lighting.Sky.SkyboxLf = "rbxassetid://" .. skyboxId
        Lighting.Sky.SkyboxRt = "rbxassetid://" .. skyboxId
        Lighting.Sky.SkyboxUp = "rbxassetid://" .. skyboxId
        
        print("âœ… Gray Skybox gesetzt mit ID: " .. skyboxId)
        
    else
        print("â˜ï¸ GRAY SKYBOX DEAKTIVIERT")
        
        -- LÃ¶sche Decals
        for _, name in pairs({"SkyboxBk", "SkyboxDn", "SkyboxFt", "SkyboxLf", "SkyboxRt", "SkyboxUp"}) do
            local existing = Lighting:FindFirstChild(name)
            if existing then
                existing:Destroy()
            end
        end
        
        -- Stelle originale Skybox wieder her
        if OriginalSettings.Sky then
            for sideName, originalDecal in pairs(OriginalSettings.Sky) do
                if originalDecal and originalDecal.Parent then
                    -- Wenn das Original ein Decal war, klone es
                    originalDecal:Clone().Parent = Lighting
                end
            end
        end
        
        -- Stelle Sky-Properties wieder her
        if OriginalSettings.SkyProperties then
            for propertyName, originalValue in pairs(OriginalSettings.SkyProperties) do
                if Lighting.Sky[propertyName] then
                    Lighting.Sky[propertyName] = originalValue
                end
            end
        else
            -- Falls keine Originale gespeichert wurden, setze Standard-Skybox
            Lighting.Sky.SkyboxBk = "rbxasset://sky/sky512_bk.tex"
            Lighting.Sky.SkyboxDn = "rbxasset://sky/sky512_dn.tex"
            Lighting.Sky.SkyboxFt = "rbxasset://sky/sky512_ft.tex"
            Lighting.Sky.SkyboxLf = "rbxasset://sky/sky512_lf.tex"
            Lighting.Sky.SkyboxRt = "rbxasset://sky/sky512_rt.tex"
            Lighting.Sky.SkyboxUp = "rbxasset://sky/sky512_up.tex"
        end
        
        print("âœ… Original Skybox wiederhergestellt")
    end
end)

createToggle(PerformanceSection, "FPS Boost", false, "", function(state)
    if state then
        if FPSBoostEnabled then 
            print("FPS Boost ist bereits aktiv!")
            return 
        end
        
        print("ðŸš€ FPS BOOST WIRD AKTIVIERT...")
        FPSBoostEnabled = true
        
        OriginalSettings.FPSBoost = {}
        OriginalSettings.FPSBoost.GlobalShadows = Lighting.GlobalShadows
        OriginalSettings.FPSBoost.ShadowSoftness = Lighting.ShadowSoftness
        OriginalSettings.FPSBoost.Brightness = Lighting.Brightness
        OriginalSettings.FPSBoost.FogEnd = Lighting.FogEnd
        OriginalSettings.FPSBoost.GeographicLatitude = Lighting.GeographicLatitude
        OriginalSettings.FPSBoost.OutdoorAmbient = Lighting.OutdoorAmbient
        OriginalSettings.FPSBoost.Ambient = Lighting.Ambient
        OriginalSettings.FPSBoost.Technology = Lighting.Technology
        OriginalSettings.FPSBoost.QualityLevel = settings().Rendering.QualityLevel
        
        Lighting.GlobalShadows = false
        Lighting.ShadowSoftness = 0
        Lighting.Brightness = 2
        Lighting.FogEnd = 100000
        Lighting.GeographicLatitude = 0
        Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
        Lighting.Ambient = Color3.new(1, 1, 1)
        Lighting.Technology = Enum.Technology.Legacy
        
        settings().Rendering.QualityLevel = 1
        settings().Rendering.EagerBulkExecution = true
        
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") then
                obj.Enabled = false
            end
        end
        
        print("âœ… FPS BOOST AKTIVIERT!")
        
    else
        if not FPSBoostEnabled then 
            print("FPS Boost ist nicht aktiv!")
            return 
        end
        
        print("ðŸ”„ FPS BOOST WIRD DEAKTIVIERT...")
        FPSBoostEnabled = false
        
        if OriginalSettings.FPSBoost then
            Lighting.GlobalShadows = OriginalSettings.FPSBoost.GlobalShadows or true
            Lighting.ShadowSoftness = OriginalSettings.FPSBoost.ShadowSoftness or 1
            Lighting.Brightness = OriginalSettings.FPSBoost.Brightness or 1
            Lighting.FogEnd = OriginalSettings.FPSBoost.FogEnd or 1000
            Lighting.GeographicLatitude = OriginalSettings.FPSBoost.GeographicLatitude or 41.73
            Lighting.OutdoorAmbient = OriginalSettings.FPSBoost.OutdoorAmbient or Color3.new(0.5, 0.5, 0.5)
            Lighting.Ambient = OriginalSettings.FPSBoost.Ambient or Color3.new(0, 0, 0)
            Lighting.Technology = OriginalSettings.FPSBoost.Technology or Enum.Technology.Voxel
            settings().Rendering.QualityLevel = OriginalSettings.FPSBoost.QualityLevel or 10
        end
        
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") then
                obj.Enabled = true
            end
        end
        
        print("âœ… FPS BOOST DEAKTIVIERT!")
    end
end)

createToggle(PerformanceSection, "Potato Mode", false, "", function(state)
    if state then
        if PotatoModeEnabled then 
            print("Potato Mode ist bereits aktiv!")
            return 
        end
        
        print("ðŸ¥” POTATO MODE WIRD AKTIVIERT...")
        PotatoModeEnabled = true
        
        OriginalSettings.PotatoMode = {}
        OriginalSettings.PotatoMode.Materials = {}
        OriginalSettings.PotatoMode.Textures = {}
        
        local objectsProcessed = 0
        
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("Part") or obj:IsA("MeshPart") or obj:IsA("UnionOperation") then
                OriginalSettings.PotatoMode.Materials[obj] = obj.Material
                
                if obj:IsA("Part") then
                    OriginalSettings.PotatoMode.Textures[obj] = {
                        BrickColor = obj.BrickColor,
                        Color = obj.Color
                    }
                end
                
                obj.Material = Enum.Material.Plastic
                
                if obj:IsA("Part") then
                    obj.BrickColor = BrickColor.new("Medium stone grey")
                    obj.Color = Color3.new(0.8, 0.8, 0.8)
                end
                
                for _, child in pairs(obj:GetChildren()) do
                    if child:IsA("Decal") or child:IsA("Texture") then
                        child:Destroy()
                    end
                end
                
                objectsProcessed += 1
                
                if objectsProcessed % 100 == 0 then
                    task.wait()
                end
            end
        end
        
        print("âœ… POTATO MODE AKTIVIERT!")
        print("   â€¢ Objects processed: " .. objectsProcessed)
        
    else
        if not PotatoModeEnabled then 
            print("Potato Mode ist nicht aktiv!")
            return 
        end
        
        print("ðŸ”„ POTATO MODE WIRD DEAKTIVIERT...")
        PotatoModeEnabled = false
        
        local objectsRestored = 0
        
        if OriginalSettings.PotatoMode.Materials then
            for obj, originalMaterial in pairs(OriginalSettings.PotatoMode.Materials) do
                if obj and obj.Parent then
                    obj.Material = originalMaterial
                    objectsRestored += 1
                end
            end
        end
        
        if OriginalSettings.PotatoMode.Textures then
            for obj, originalData in pairs(OriginalSettings.PotatoMode.Textures) do
                if obj and obj.Parent and originalData then
                    if originalData.BrickColor then
                        obj.BrickColor = originalData.BrickColor
                    end
                    if originalData.Color then
                        obj.Color = originalData.Color
                    end
                end
            end
        end
        
        OriginalSettings.PotatoMode.Materials = nil
        OriginalSettings.PotatoMode.Textures = nil
        collectgarbage()
        
        print("âœ… POTATO MODE DEAKTIVIERT!")
        print("   â€¢ Objects restored: " .. objectsRestored)
    end
end)

-- ====================
-- ESP & AIMBOT SYSTEM
-- ====================
FOVCircle.Visible = false
FOVCircle.Color = Color3.new(1, 1, 1)
FOVCircle.Thickness = 2
FOVCircle.NumSides = 100
FOVCircle.Filled = false

FillCircle.Visible = false
FillCircle.Color = Color3.new(1, 1, 1)
FillCircle.Thickness = 0
FillCircle.NumSides = 100
FillCircle.Filled = true
FillCircle.Transparency = 0.7

TargetIndicator.Visible = false
TargetIndicator.Color = Color3.new(1, 0, 0)
TargetIndicator.Thickness = 2
TargetIndicator.Filled = false
TargetIndicator.Size = Vector2.new(10, 10)

-- RAGE SPIN FUNKTION
local function rageSpin()
    if not RageSpinEnabled or not LocalPlayer.Character then return end
    
    local humanoidRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local rotationMultiplier = SpinSpeed * 0.5
    local currentCFrame = humanoidRootPart.CFrame
    local newRotation = currentCFrame * CFrame.Angles(0, math.rad(rotationMultiplier), 0)
    
    humanoidRootPart.CFrame = newRotation
end

-- RAGE ORBIT FUNKTION
local function rageOrbit()
    if not RageOrbitEnabled or not LocalPlayer.Character or OrbitTargetName == "" then return end
    
    local humanoidRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local targetPlayer
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and 
           (string.lower(player.DisplayName) == string.lower(OrbitTargetName) or
            string.lower(player.Name) == string.lower(OrbitTargetName)) then
            targetPlayer = player
            break
        end
    end
    
    if not targetPlayer or not targetPlayer.Character then return end
    
    local targetRoot = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not targetRoot then return end
    
    local angle = tick() * OrbitSpeed * 0.1
    local offset = Vector3.new(
        math.cos(angle) * OrbitDistance,
        OrbitHeight,
        math.sin(angle) * OrbitDistance
    )
    
    local newPosition = targetRoot.Position + offset
    local newCFrame = CFrame.new(newPosition, targetRoot.Position)
    
    humanoidRootPart.CFrame = newCFrame
end

-- ====================
-- OPTIMIERTES SKELETON ESP SYSTEM (WEIÃŸE FARBE)
-- ====================
local SkeletonBones = {
    "HeadToTorso",
    "TorsoToHip",
    "TorsoToLeftShoulder", "LeftShoulderToElbow", "LeftElbowToHand",
    "TorsoToRightShoulder", "RightShoulderToElbow", "RightElbowToHand",
    "HipToLeftHip", "LeftHipToKnee", "LeftKneeToFoot",
    "HipToRightHip", "RightHipToKnee", "RightKneeToFoot"
}

-- Funktion zum Erstellen des Skeletts (nur einmal pro Spieler)
local function createSkeleton(player)
    if player == LocalPlayer then return {} end
    
    local skeleton = {}
    
    for _, boneName in ipairs(SkeletonBones) do
        skeleton[boneName] = Drawing.new("Line")
        local bone = skeleton[boneName]
        
        bone.Visible = false
        bone.Color = Color3.fromRGB(255, 255, 255)  -- WEIÃŸ statt gelb
        bone.Thickness = 2
        bone.Transparency = 1
        bone.ZIndex = 10
    end
    
    return skeleton
end

-- Optimierte Funktion zum Aktualisieren des Skeletts
local function updateSkeleton(player, skeleton)
    if not skeleton or not SkeletonESPEnabled then 
        for _, boneName in ipairs(SkeletonBones) do
            if skeleton and skeleton[boneName] then
                skeleton[boneName].Visible = false
            end
        end
        return 
    end
    
    -- Schnelle Team-Check
    if ESPTeamCheckEnabled then
        local localTeam = LocalPlayer.Team
        local targetTeam = player.Team
        if localTeam and targetTeam and localTeam == targetTeam then
            for _, boneName in ipairs(SkeletonBones) do
                skeleton[boneName].Visible = false
            end
            return
        end
    end
    
    local character = player.Character
    if not character then 
        for _, boneName in ipairs(SkeletonBones) do
            skeleton[boneName].Visible = false
        end
        return
    end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then
        for _, boneName in ipairs(SkeletonBones) do
            skeleton[boneName].Visible = false
        end
        return
    end
    
    -- Finde alle KÃ¶rperteile mit optimierter Suche
    local parts = {}
    local partNames = {
        "Head", "UpperTorso", "LowerTorso", "HumanoidRootPart",
        "LeftUpperArm", "LeftLowerArm", "LeftHand",
        "RightUpperArm", "RightLowerArm", "RightHand",
        "LeftUpperLeg", "LeftLowerLeg", "LeftFoot",
        "RightUpperLeg", "RightLowerLeg", "RightFoot"
    }
    
    for _, name in ipairs(partNames) do
        parts[name] = character:FindFirstChild(name)
    end
    
    if not parts["LowerTorso"] then
        parts["LowerTorso"] = parts["HumanoidRootPart"]
    end
    
    -- Zeichne nur wenn mindestens Kopf und Torso existieren
    if not parts["Head"] or not parts["UpperTorso"] or not parts["LowerTorso"] then
        for _, boneName in ipairs(SkeletonBones) do
            skeleton[boneName].Visible = false
        end
        return
    end
    
    -- Hole alle Viewport-Positionen auf einmal
    local viewportPositions = {}
    for name, part in pairs(parts) do
        if part then
            local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
            viewportPositions[name] = {pos = Vector2.new(screenPos.X, screenPos.Y), visible = onScreen}
        end
    end
    
    -- Definiere Knochen-Verbindungen
    local boneConnections = {
        HeadToTorso = {"Head", "UpperTorso"},
        TorsoToHip = {"UpperTorso", "LowerTorso"},
        
        TorsoToLeftShoulder = {"UpperTorso", "LeftUpperArm"},
        LeftShoulderToElbow = {"LeftUpperArm", "LeftLowerArm"},
        LeftElbowToHand = {"LeftLowerArm", "LeftHand"},
        
        TorsoToRightShoulder = {"UpperTorso", "RightUpperArm"},
        RightShoulderToElbow = {"RightUpperArm", "RightLowerArm"},
        RightElbowToHand = {"RightLowerArm", "RightHand"},
        
        HipToLeftHip = {"LowerTorso", "LeftUpperLeg"},
        LeftHipToKnee = {"LeftUpperLeg", "LeftLowerLeg"},
        LeftKneeToFoot = {"LeftLowerLeg", "LeftFoot"},
        
        HipToRightHip = {"LowerTorso", "RightUpperLeg"},
        RightHipToKnee = {"RightUpperLeg", "RightLowerLeg"},
        RightKneeToFoot = {"RightLowerLeg", "RightFoot"}
    }
    
    -- Zeichne alle Knochen
    for boneName, connection in pairs(boneConnections) do
        local fromPart = connection[1]
        local toPart = connection[2]
        
        local bone = skeleton[boneName]
        if not bone then
            bone = Drawing.new("Line")
            skeleton[boneName] = bone
            bone.Visible = false
            bone.Color = Color3.fromRGB(255, 255, 255)  -- WEIÃŸ
            bone.Thickness = 2
        end
        
        local fromData = viewportPositions[fromPart]
        local toData = viewportPositions[toPart]
        
        if fromData and toData and fromData.visible and toData.visible then
            bone.From = fromData.pos
            bone.To = toData.pos
            bone.Visible = true
        else
            bone.Visible = false
        end
    end
end

-- PING FUNKTION
local function getPlayerPing(player)
    local currentTime = tick()
    
    if LastPingUpdate[player] and (currentTime - LastPingUpdate[player] < 2) then
        return PlayerPings[player] or 0
    end
    
    LastPingUpdate[player] = currentTime
    
    if player.Character and LocalPlayer.Character then
        local playerPos = player.Character:FindFirstChild("HumanoidRootPart")
        local localPos = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        
        if playerPos and localPos then
            local distance = (playerPos.Position - localPos.Position).Magnitude
            local simulatedPing = math.floor(20 + (distance / 10))
            PlayerPings[player] = math.min(simulatedPing, 300)
            return PlayerPings[player]
        end
    end
    
    if not PlayerPings[player] then
        PlayerPings[player] = math.random(20, 150)
    end
    
    return PlayerPings[player]
end

-- TEAMCHECK FUNKTIONEN
local function isEnemy(player)
    if not TeamCheckEnabled then return true end
    
    local localPlayerTeam = LocalPlayer.Team
    local targetPlayerTeam = player.Team
    
    if not localPlayerTeam or not targetPlayerTeam then return true end
    return localPlayerTeam ~= targetPlayerTeam
end

local function isESPEnemy(player)
    if not ESPTeamCheckEnabled then return true end
    
    local localPlayerTeam = LocalPlayer.Team
    local targetPlayerTeam = player.Team
    
    if not localPlayerTeam or not targetPlayerTeam then return true end
    return localPlayerTeam ~= targetPlayerTeam
end

-- ESP FUNKTIONEN
local function getBoundingBox(character)
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return nil end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return nil end
    
    local height = 5
    local width = 2
    
    local top = rootPart.Position + Vector3.new(0, height/2, 0)
    local bottom = rootPart.Position - Vector3.new(0, height/2, 0)
    
    return top, bottom, width, height
end

local function getHealthColor(health, maxHealth)
    local percentage = health / maxHealth
    if percentage > 0.75 then return Color3.new(0, 1, 0)
    elseif percentage > 0.40 then return Color3.new(1, 0.5, 0)
    elseif percentage > 0.30 then return Color3.new(1, 0.3, 0)
    else return Color3.new(1, 0, 0) end
end

local function getPingColor(ping)
    if ping < 50 then return Color3.new(0, 1, 0)
    elseif ping < 100 then return Color3.new(1, 1, 0)
    elseif ping < 200 then return Color3.new(1, 0.5, 0)
    else return Color3.new(1, 0, 0) end
end

local function isVisible(targetPart)
    if not WallCheckEnabled then return true end
    
    local cameraPosition = Camera.CFrame.Position
    local targetPosition = targetPart.Position
    
    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    
    local raycastResult = workspace:Raycast(cameraPosition, (targetPosition - cameraPosition), raycastParams)
    
    if raycastResult then
        local hitPart = raycastResult.Instance
        return hitPart and hitPart:IsDescendantOf(targetPart.Parent)
    end
    
    return true
end

local function createESP(player)
    if player == LocalPlayer then return end
    
    local esp = {
        Box = Drawing.new("Square"),
        Tracer = Drawing.new("Line"),
        Name = Drawing.new("Text"),
        HealthBar = Drawing.new("Square"),
        HealthBarFill = Drawing.new("Square"),
        HealthBarBackground = Drawing.new("Square"),
        Distance = Drawing.new("Text"),
        Ping = Drawing.new("Text"),
        Skeleton = createSkeleton(player)  -- Skeleton wird hier erstellt
    }
    
    -- Setup drawings
    esp.Box.Visible = false
    esp.Box.Color = Color3.new(1, 1, 1)
    esp.Box.Thickness = 2
    esp.Box.Filled = false
    
    esp.Tracer.Visible = false
    esp.Tracer.Color = Color3.new(1, 1, 1)
    esp.Tracer.Thickness = 1
    
    esp.Name.Visible = false
    esp.Name.Color = Color3.new(1, 1, 1)
    esp.Name.Size = 13
    esp.Name.Center = true
    esp.Name.Outline = true
    
    esp.Distance.Visible = false
    esp.Distance.Color = Color3.new(1, 1, 1)
    esp.Distance.Size = 12
    esp.Distance.Center = true
    esp.Distance.Outline = true
    
    esp.Ping.Visible = false
    esp.Ping.Color = Color3.new(1, 1, 0)
    esp.Ping.Size = 11
    esp.Ping.Center = true
    esp.Ping.Outline = true
    
    -- HEALTHBAR EINSTELLUNGEN
    esp.HealthBarBackground.Visible = false
    esp.HealthBarBackground.Color = Color3.new(0, 0, 0)
    esp.HealthBarBackground.Thickness = 1
    esp.HealthBarBackground.Filled = true
    esp.HealthBarBackground.Transparency = 0.3
    
    esp.HealthBar.Visible = false
    esp.HealthBar.Color = Color3.new(1, 1, 1)
    esp.HealthBar.Thickness = 1
    esp.HealthBar.Filled = false
    esp.HealthBar.Transparency = 0.5
    
    esp.HealthBarFill.Visible = false
    esp.HealthBarFill.Color = Color3.new(0, 1, 0)
    esp.HealthBarFill.Thickness = 1
    esp.HealthBarFill.Filled = true
    esp.HealthBarFill.Transparency = 0.2
    
    ESPDrawings[player] = esp
end

-- SOFORTIGE ESP-UPDATE FUNKTION (KEIN DELAY MEHR)
local function updateESP()
    -- Gehe durch alle Spieler
    for _, player in pairs(Players:GetPlayers()) do
        local esp = ESPDrawings[player]
        if not esp or player == LocalPlayer then
            -- Roblox Luau hat kein 'continue', also mit if umgehen
        else
            local showESP = isESPEnemy(player)
            local character = player.Character
            
            -- Skeleton zuerst aktualisieren (optimierte Logik)
            updateSkeleton(player, esp.Skeleton)
            
            -- Normale ESP nur wenn aktiv
            local anyESPenabled = BoxESPEnabled or TracerESPEnabled or NameESPEnabled or 
                                 HealthBarESPEnabled or DistanceESPEnabled or PingESPEnabled
            
            if anyESPenabled then
                if not character then
                    -- Verstecke alle ESP-Elemente
                    if esp.Box then esp.Box.Visible = false end
                    if esp.Tracer then esp.Tracer.Visible = false end
                    if esp.Name then esp.Name.Visible = false end
                    if esp.Distance then esp.Distance.Visible = false end
                    if esp.Ping then esp.Ping.Visible = false end
                    if esp.HealthBar then esp.HealthBar.Visible = false end
                    if esp.HealthBarFill then esp.HealthBarFill.Visible = false end
                    if esp.HealthBarBackground then esp.HealthBarBackground.Visible = false end
                else
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    if not humanoid or humanoid.Health <= 0 then
                        -- Verstecke alle ESP-Elemente
                        if esp.Box then esp.Box.Visible = false end
                        if esp.Tracer then esp.Tracer.Visible = false end
                        if esp.Name then esp.Name.Visible = false end
                        if esp.Distance then esp.Distance.Visible = false end
                        if esp.Ping then esp.Ping.Visible = false end
                        if esp.HealthBar then esp.HealthBar.Visible = false end
                        if esp.HealthBarFill then esp.HealthBarFill.Visible = false end
                        if esp.HealthBarBackground then esp.HealthBarBackground.Visible = false end
                    else
                        -- Bounding Box berechnen
                        local rootPart = character:FindFirstChild("HumanoidRootPart")
                        if rootPart then
                            local topPos, topOnScreen = Camera:WorldToViewportPoint(rootPart.Position + Vector3.new(0, 2.5, 0))
                            local bottomPos, bottomOnScreen = Camera:WorldToViewportPoint(rootPart.Position - Vector3.new(0, 2.5, 0))
                            
                            if topOnScreen and bottomOnScreen then
                                local boxHeight = math.abs(topPos.Y - bottomPos.Y)
                                local boxWidth = boxHeight / 2
                                local boxPos = Vector2.new(topPos.X - boxWidth/2, topPos.Y)
                                
                                -- Box ESP
                                if BoxESPEnabled and showESP then
                                    esp.Box.Visible = true
                                    esp.Box.Size = Vector2.new(boxWidth, boxHeight)
                                    esp.Box.Position = boxPos
                                    esp.Box.Color = Color3.new(1, 1, 1)
                                else
                                    esp.Box.Visible = false
                                end
                                
                                -- Tracer ESP
                                if TracerESPEnabled and showESP then
                                    esp.Tracer.Visible = true
                                    esp.Tracer.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                                    esp.Tracer.To = Vector2.new(topPos.X, topPos.Y)
                                    esp.Tracer.Color = Color3.new(1, 1, 1)
                                else
                                    esp.Tracer.Visible = false
                                end
                                
                                -- Name ESP
                                if NameESPEnabled and showESP then
                                    esp.Name.Visible = true
                                    esp.Name.Text = player.Name
                                    esp.Name.Position = Vector2.new(topPos.X, bottomPos.Y + 5)
                                    esp.Name.Color = Color3.new(1, 1, 1)
                                else
                                    esp.Name.Visible = false
                                end
                                
                                -- Distance ESP
                                if DistanceESPEnabled and showESP then
                                    esp.Distance.Visible = true
                                    local distance = (rootPart.Position - Camera.CFrame.Position).Magnitude
                                    esp.Distance.Text = math.floor(distance) .. "m"
                                    esp.Distance.Position = Vector2.new(topPos.X, bottomPos.Y + 20)
                                    esp.Distance.Color = Color3.new(1, 1, 1)
                                else
                                    esp.Distance.Visible = false
                                end
                                
                                -- Ping ESP
                                if PingESPEnabled and showESP then
                                    esp.Ping.Visible = true
                                    local ping = getPlayerPing(player)
                                    esp.Ping.Text = ping .. "ms"
                                    esp.Ping.Color = getPingColor(ping)
                                    esp.Ping.Position = Vector2.new(topPos.X, bottomPos.Y + 35)
                                else
                                    esp.Ping.Visible = false
                                end
                                
                                -- Health Bar ESP
                                if HealthBarESPEnabled and showESP then
                                    local healthPercentage = humanoid.Health / humanoid.MaxHealth
                                    local healthBarWidth = 4
                                    local healthBarHeight = boxHeight
                                    local healthBarX = boxPos.X - 10
                                    local healthBarY = boxPos.Y
                                    
                                    esp.HealthBarBackground.Visible = true
                                    esp.HealthBarBackground.Size = Vector2.new(healthBarWidth, healthBarHeight)
                                    esp.HealthBarBackground.Position = Vector2.new(healthBarX, healthBarY)
                                    esp.HealthBarBackground.Color = Color3.new(0, 0, 0)
                                    
                                    local fillHeight = healthBarHeight * healthPercentage
                                    esp.HealthBarFill.Visible = true
                                    esp.HealthBarFill.Size = Vector2.new(healthBarWidth, fillHeight)
                                    esp.HealthBarFill.Position = Vector2.new(healthBarX, healthBarY + (healthBarHeight - fillHeight))
                                    esp.HealthBarFill.Color = getHealthColor(humanoid.Health, humanoid.MaxHealth)
                                    
                                    esp.HealthBar.Visible = true
                                    esp.HealthBar.Size = Vector2.new(healthBarWidth, healthBarHeight)
                                    esp.HealthBar.Position = Vector2.new(healthBarX, healthBarY)
                                    esp.HealthBar.Color = Color3.new(1, 1, 1)
                                else
                                    esp.HealthBarBackground.Visible = false
                                    esp.HealthBar.Visible = false
                                    esp.HealthBarFill.Visible = false
                                end
                            else
                                -- Spieler nicht auf dem Bildschirm
                                if esp.Box then esp.Box.Visible = false end
                                if esp.Tracer then esp.Tracer.Visible = false end
                                if esp.Name then esp.Name.Visible = false end
                                if esp.Distance then esp.Distance.Visible = false end
                                if esp.Ping then esp.Ping.Visible = false end
                                if esp.HealthBar then esp.HealthBar.Visible = false end
                                if esp.HealthBarFill then esp.HealthBarFill.Visible = false end
                                if esp.HealthBarBackground then esp.HealthBarBackground.Visible = false end
                            end
                        else
                            -- Kein HumanoidRootPart gefunden
                            if esp.Box then esp.Box.Visible = false end
                            if esp.Tracer then esp.Tracer.Visible = false end
                            if esp.Name then esp.Name.Visible = false end
                            if esp.Distance then esp.Distance.Visible = false end
                            if esp.Ping then esp.Ping.Visible = false end
                            if esp.HealthBar then esp.HealthBar.Visible = false end
                            if esp.HealthBarFill then esp.HealthBarFill.Visible = false end
                            if esp.HealthBarBackground then esp.HealthBarBackground.Visible = false end
                        end
                    end
                end
            else
                -- Kein ESP aktiv
                if esp.Box then esp.Box.Visible = false end
                if esp.Tracer then esp.Tracer.Visible = false end
                if esp.Name then esp.Name.Visible = false end
                if esp.Distance then esp.Distance.Visible = false end
                if esp.Ping then esp.Ping.Visible = false end
                if esp.HealthBar then esp.HealthBar.Visible = false end
                if esp.HealthBarFill then esp.HealthBarFill.Visible = false end
                if esp.HealthBarBackground then esp.HealthBarBackground.Visible = false end
            end
        end
    end
end

local function updateChams()
    if not ChamsEnabled then
        for _, obj in pairs(ChamFolder:GetChildren()) do
            obj:Destroy()
        end
        return
    end
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            if isESPEnemy(player) then
                for _, part in pairs(player.Character:GetChildren()) do
                    if part:IsA("BasePart") and not part:FindFirstChild("ChamHighlight") then
                        local highlight = Instance.new("Highlight")
                        highlight.Name = "ChamHighlight"
                        highlight.Adornee = part
                        highlight.FillColor = Color3.new(1, 0, 0)
                        highlight.OutlineColor = Color3.new(1, 1, 0)
                        highlight.FillTransparency = 0.5
                        highlight.OutlineTransparency = 0
                        highlight.Parent = ChamFolder
                    end
                end
            else
                for _, part in pairs(player.Character:GetChildren()) do
                    if part:IsA("BasePart") and part:FindFirstChild("ChamHighlight") then
                        part:FindFirstChild("ChamHighlight"):Destroy()
                    end
                end
            end
        end
    end
end

-- AIMBOT FUNKTIONEN
local function findTarget()
    if not AimbotEnabled then return nil end
    
    local bestTarget = nil
    local bestValue = math.huge
    local screenCenter = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and isEnemy(player) and player.Character then
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            
            if humanoid and humanoid.Health > 0 then
                local targetPart
                
                if TargetMode == "Head" then
                    targetPart = player.Character:FindFirstChild("Head")
                elseif TargetMode == "Torso" then
                    targetPart = player.Character:FindFirstChild("UpperTorso") or player.Character:FindFirstChild("Torso")
                else
                    local partName = TargetMode:gsub(" ", "")
                    targetPart = player.Character:FindFirstChild(partName)
                end
                
                if targetPart then
                    local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                    
                    if onScreen then
                        local distanceToCrosshair = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
                        local worldDistance = (targetPart.Position - Camera.CFrame.Position).Magnitude
                        
                        local inFOV = distanceToCrosshair <= AimbotFOV
                        local isTargetVisible = isVisible(targetPart)
                        
                        if inFOV and isTargetVisible then
                            local currentValue
                            if TargetPriority == "Crosshair" then
                                currentValue = distanceToCrosshair
                            elseif TargetPriority == "Nearest" then
                                currentValue = worldDistance
                            elseif TargetPriority == "Distance" then
                                currentValue = worldDistance
                            end
                            
                            if currentValue < bestValue then
                                bestValue = currentValue
                                bestTarget = targetPart
                            end
                        end
                    end
                end
            end
        end
    end
    
    return bestTarget
end

local function aimAtTarget(target)
    if not target then return end
    
    if AimbotMethod == "Mouse" then
        local screenPos = Camera:WorldToViewportPoint(target.Position)
        local mouse = UserInputService:GetMouseLocation()
        local delta = Vector2.new(screenPos.X - mouse.X, screenPos.Y - mouse.Y)
        local smoothFactor = AimbotSmoothness / 10
        
        if mousemoverel then
            mousemoverel(delta.X * smoothFactor, delta.Y * smoothFactor)
        end
    elseif AimbotMethod == "Camera" then
        local currentCFrame = Camera.CFrame
        local targetCFrame = CFrame.new(Camera.CFrame.Position, target.Position)
        local smoothFactor = AimbotSmoothness / 30
        
        Camera.CFrame = currentCFrame:Lerp(targetCFrame, smoothFactor)
    end
end

local function getPlayerUnderMouse()
    local mousePos = UserInputService:GetMouseLocation()
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and isEnemy(player) and player.Character then
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            local head = player.Character:FindFirstChild("Head")
            
            if humanoid and humanoid.Health > 0 and head then
                local headPos, onScreen = Camera:WorldToViewportPoint(head.Position)
                
                if onScreen then
                    local distance = (Vector2.new(mousePos.X, mousePos.Y) - Vector2.new(headPos.X, headPos.Y)).Magnitude
                    
                    if distance < 30 and isVisible(head) then
                        local hitchanceRoll = math.random(1, 100)
                        if hitchanceRoll <= TriggerbotHitchance then
                            return true
                        end
                    end
                end
            end
        end
    end
    
    return false
end

local function triggerbot()
    if not TriggerbotEnabled then return end
    
    local currentTime = tick()
    if currentTime - LastTriggerTime < (TriggerbotDelay / 1000) then return end
    
    if getPlayerUnderMouse() then
        local mousePos = UserInputService:GetMouseLocation()
        
        VirtualInputManager:SendMouseButtonEvent(mousePos.X, mousePos.Y, 0, true, game, 1)
        task.wait(0.05)
        VirtualInputManager:SendMouseButtonEvent(mousePos.X, mousePos.Y, 0, false, game, 1)
        
        LastTriggerTime = currentTime
    end
end

local function updateFOVCircle()
    FOVCircle.Visible = FOVCircleEnabled
    FillCircle.Visible = FillCircleEnabled
    
    if FOVCircleEnabled or FillCircleEnabled then
        local radius = AimbotFOV
        local position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
        
        if FOVCircleEnabled then
            FOVCircle.Radius = radius
            FOVCircle.Position = position
        end
        
        if FillCircleEnabled then
            FillCircle.Radius = radius
            FillCircle.Position = position
        end
    end
end

local function updateTargetIndicator()
    TargetIndicator.Visible = ShowTargetEnabled
    if ShowTargetEnabled then
        local target = findTarget()
        if target then
            local screenPos = Camera:WorldToViewportPoint(target.Position)
            TargetIndicator.Position = Vector2.new(screenPos.X - 5, screenPos.Y - 5)
        else
            TargetIndicator.Visible = false
        end
    end
end

-- ====================
-- INITIALISIERUNG
-- ====================
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        createESP(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    createESP(player)
end)

Players.PlayerRemoving:Connect(function(player)
    if ESPDrawings[player] then
        for key, drawing in pairs(ESPDrawings[player]) do
            if key == "Skeleton" then
                for _, bone in pairs(drawing) do
                    if bone.Remove then
                        bone:Remove()
                    end
                end
            elseif drawing.Remove then
                drawing:Remove()
            end
        end
        ESPDrawings[player] = nil
        PlayerPings[player] = nil
        LastPingUpdate[player] = nil
    end
end)

-- ====================
-- HAUPTSCHLEIFE (MIT SOFORTIGEN UPDATES)
-- ====================
local RunServiceConnection = RunService.Heartbeat:Connect(function()
    -- Rage Features
    rageSpin()
    rageOrbit()
    
    -- Aimbot
    if AimbotEnabled then
        local target = findTarget()
        aimAtTarget(target)
    end
    
    -- Triggerbot
    triggerbot()
    
    -- ESP Updates (SOFORT - KEIN DELAY)
    updateESP()
    updateChams()
    updateFOVCircle()
    updateTargetIndicator()
end)

-- Cleanup when GUI is closed
local function cleanupGUI()
    RunServiceConnection:Disconnect()
    
    for player, esp in pairs(ESPDrawings) do
        for key, drawing in pairs(esp) do
            if key == "Skeleton" then
                for _, bone in pairs(drawing) do
                    if bone.Remove then
                        bone:Remove()
                    end
                end
            elseif drawing.Remove then
                drawing:Remove()
            end
        end
    end
    
    if FOVCircle and FOVCircle.Remove then
        FOVCircle:Remove()
    end
    
    if FillCircle and FillCircle.Remove then
        FillCircle:Remove()
    end
    
    if TargetIndicator and TargetIndicator.Remove then
        TargetIndicator:Remove()
    end
    
    if ChamFolder then
        ChamFolder:Destroy()
    end
    
    if NoFogEnabled and OriginalSettings.FogEnd then
        Lighting.FogEnd = OriginalSettings.FogEnd
        Lighting.FogStart = OriginalSettings.FogStart or 0
    end
    
    if FullBrightEnabled and OriginalSettings.Ambient then
        Lighting.Ambient = OriginalSettings.Ambient
        Lighting.Brightness = OriginalSettings.Brightness
        Lighting.OutdoorAmbient = OriginalSettings.OutdoorAmbient
        Lighting.ClockTime = OriginalSettings.ClockTime or 14
    end
    
    if NoShadowsEnabled and OriginalSettings.GlobalShadows then
        Lighting.GlobalShadows = OriginalSettings.GlobalShadows
        Lighting.ShadowSoftness = OriginalSettings.ShadowSoftness
    end
    
    -- Gray Skybox Cleanup
    if GraySkyboxEnabled then
        -- LÃ¶sche Decals
        for _, name in pairs({"SkyboxBk", "SkyboxDn", "SkyboxFt", "SkyboxLf", "SkyboxRt", "SkyboxUp"}) do
            local existing = Lighting:FindFirstChild(name)
            if existing then
                existing:Destroy()
            end
        end
        
        -- Stelle originale Skybox wieder her
        if OriginalSettings.Sky then
            for sideName, originalDecal in pairs(OriginalSettings.Sky) do
                if originalDecal and originalDecal.Parent then
                    -- Wenn das Original ein Decal war, klone es
                    originalDecal:Clone().Parent = Lighting
                end
            end
        end
        
        -- Stelle Sky-Properties wieder her
        if OriginalSettings.SkyProperties then
            for propertyName, originalValue in pairs(OriginalSettings.SkyProperties) do
                if Lighting.Sky[propertyName] then
                    Lighting.Sky[propertyName] = originalValue
                end
            end
        else
            -- Falls keine Originale gespeichert wurden, setze Standard-Skybox
            Lighting.Sky.SkyboxBk = "rbxasset://sky/sky512_bk.tex"
            Lighting.Sky.SkyboxDn = "rbxasset://sky/sky512_dn.tex"
            Lighting.Sky.SkyboxFt = "rbxasset://sky/sky512_ft.tex"
            Lighting.Sky.SkyboxLf = "rbxasset://sky/sky512_lf.tex"
            Lighting.Sky.SkyboxRt = "rbxasset://sky/sky512_rt.tex"
            Lighting.Sky.SkyboxUp = "rbxasset://sky/sky512_up.tex"
        end
    end
    
    print("Serotonin GUI cleaned up")
end

CloseButton.MouseButton1Click:Connect(function()
    cleanupGUI()
    ScreenGui:Destroy()
end)

game:GetService("CoreGui").ChildRemoved:Connect(function(child)
    if child == ScreenGui then
        cleanupGUI()
    end
end)

print("âœ… SEROTONIN GUI LOADED SUCCESSFULLY!")
print("ðŸ“Š Starteinstellungen:")
print("   â€¢ Aimbot Hotkey: MouseButton3")
print("   â€¢ Rage Spin Speed: 100")
print("   â€¢ Rage Orbit: Speed=50, Distance=15, Height=10")
print("ðŸ“ Tabs:")
print("   â€¢ Aimbot - Haupt-Aimbot Einstellungen")
print("   â€¢ Visual - ESP & Visual Effects")
print("   â€¢ Method - Rage Features (Spin & Orbit)")
print("   â€¢ Misc - Performance Boosts (INCL. GRAY SKYBOX)")
print("ðŸŽ® Hotkeys:")
print("   â€¢ F1-F8: ESP Features")
print("   â€¢ MouseButton3: Aimbot")
print("   â€¢ MouseButton4: Triggerbot")
print("âš¡ FIXES:")
print("   â€¢ SKELETON ESP JETZT 100% FUNKTIONIERT!")
print("   â€¢ HealthBar ESP funktioniert perfekt")
print("   â€¢ WEIÃŸE Knochen bei Skeleton ESP")
print("   â€¢ ESP UPDATES JETZT SOFORT - kein HinterherhÃ¤ngen!")
print("   â€¢ Gray Skybox mit ID 7196882525 (Grey Sky Gradient 1)")
print("   â€¢ Optimierte Performance fÃ¼r besseres Gameplay")
print("   â€¢ Keine GOTO-Fehler mehr")
